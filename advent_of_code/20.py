import unittest
import numpy as np
import sys

sys.setrecursionlimit(10000)

data = """
#############################################################################################################################################
#.......###...#...###.....###...#...#.......#...#.............###.......#...#####.........#.....#...........###.......#...#.....#...###...###
#.#####.###.#.#.#.###.###.###.#.#.#.#.#####.#.#.#.###########.###.#####.#.#.#####.#######.#.###.#.#########.###.#####.#.#.#.###.#.#.###.#.###
#.#...#.....#...#...#...#.....#.#.#.#...#...#.#.#...........#.#...#.....#.#...#...#.....#.#.#...#.....#.....#...#.....#.#.#.#...#.#...#.#...#
#.#.#.#############.###.#######.#.#.###.#.###.#.###########.#.#.###.#####.###.#.###.###.#.#.#.#######.#.#####.###.#####.#.#.#.###.###.#.###.#
#...#.........#...#...#...#...#...#.#...#.#...#...###...###.#.#.#...#...#.#...#.....#...#.#.#...#...#.#...###...#.....#.#.#.#...#.#...#...#.#
#############.#.#.###.###.#.#.#####.#.###.#.#####.###.#.###.#.#.#.###.#.#.#.#########.###.#.###.#.#.#.###.#####.#####.#.#.#.###.#.#.#####.#.#
###...###...#...#.#...###...#...#...#...#...#.....#...#.....#...#.....#.#.#.......###...#...#...#.#.#...#.#...#.#.....#.#...#...#.#.#...#.#.#
###.#.###.#.#####.#.###########.#.#####.#####.#####.###################.#.#######.#####.#####.###.#.###.#.#.#.#.#.#####.#####.###.#.#.#.#.#.#
#...#.....#.#.....#.......#...#.#.#...#.....#.#...#.........#.....#.....#.#.......#...#.#.....#...#.###.#...#.#.#.#...#...#...###.#.#.#.#.#.#
#.#########.#.###########.#.#.#.#.#.#.#####.#.#.#.#########.#.###.#.#####.#.#######.#.#.#.#####.###.###.#####.#.#.#.#.###.#.#####.#.#.#.#.#.#
#.........#.#.........#...#.#...#...#.#.....#.#.#.....###...#...#...#...#.#...#...#.#...#.#...#...#.#...#.....#.#.#.#.###.#.#...#.#...#...#.#
#########.#.#########.#.###.#########.#.#####.#.#####.###.#####.#####.#.#.###.#.#.#.#####.#.#.###.#.#.###.#####.#.#.#.###.#.#.#.#.#########.#
#.........#.#.........#.....#.....#...#.....#.#...#...#...#.....#...#.#.#.#...#.#.#...#...#.#.###.#.#.#...###...#.#.#...#.#.#.#.#.#.........#
#.#########.#.###############.###.#.#######.#.###.#.###.###.#####.#.#.#.#.#.###.#.###.#.###.#.###.#.#.#.#####.###.#.###.#.#.#.#.#.#.#########
#.........#.#...............#.#...#.###.....#.....#...#...#.#...#.#...#.#.#...#.#...#.#.#...#.#...#...#.....#...#.#.#...#.#.#.#.#.#.....#...#
#########.#.###############.#.#.###.###.#############.###.#.#.#.#.#####.#.###.#.###.#.#.#.###.#.###########.###.#.#.#.###.#.#.#.#.#####.#.#.#
#.....#...#.#...#...#...###...#...#...#.............#.#...#...#.#.#.....#.#...#...#.#.#.#...#.#...#.........#...#...#.#...#.#.#...#...#...#.#
#.###.#.###.#.#.#.#.#.#.#########.###.#############.#.#.#######.#.#.#####.#.#####.#.#.#.###.#.###.#.#########.#######.#.###.#.#####.#.#####.#
#.#...#...#.#.#.#.#...#.#...#.....#...#.........#...#.#.....#...#.#.....#.#...#...#...#...#.#.#...#.#...#.....#.....#.#...#...#.....#.....#.#
#.#.#####.#.#.#.#.#####.#.#.#.#####.###.#######.#.###.#####.#.###.#####.#.###.#.#########.#.#.#.###.#.#.#.#####.###.#.###.#####.#########.#.#
#.#.....#.#.#.#.#.....#.#.#.#.....#.###.....#...#...#.#...#.#.###.#.....#.#...#.....#.....#.#.#...#.#.#.#...#...###...#...#...#...#.....#...#
#.#####.#.#.#.#.#####.#.#.#.#####.#.#######.#.#####.#.#.#.#.#.###.#.#####.#.#######.#.#####.#.###.#.#.#.###.#.#########.###.#.###.#.###.#####
#.....#...#.#.#.#...#.#.#.#.#...#.#...#...#.#.#.....#.#.#...#.....#...#...#.....###.#.....#.#...#.#.#.#.#...#.....###...#...#...#...#...#...#
#####.#####.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#####.#.#############.#.#######.###.#####.#.###.#.#.#.#.#.#######.###.###.#####.#####.###.#.#
#...#.#...#...#...#...#...#...#.#...#.#.#.#.#.#.#...#.#...#...........#.....#...#...#.....#...#...#.#.#...#.......#...#...#...#.....#...#.#.#
#.#.#.#.#.#####################.###.#.#.#.#.#.#.#.#.#.###.#.###############.#.###.###.#######.#####.#.#####.#######.###.###.#.#####.###.#.#.#
#.#...#.#.......#.............#...#.#.#.#.#.#...#.#...#...#.......#...#...#.#...#...#.#.....#.....#.#.#.....#.....#.#...#...#.....#.....#.#.#
#.#####.#######.#.###########.###.#.#.#.#.#.#####.#####.#########.#.#.#.#.#.###.###.#.#.###.#####.#.#.#.#####.###.#.#.###.#######.#######.#.#
#.#...#.#.......#.###...#...#.#...#.#.#.#.#...#...#...#...#.....#.#.#.#.#.#...#...#.#.#.#...#...#.#.#.#.#...#...#.#.#...#.......#.......#.#.#
#.#.#.#.#.#######.###.#.#.#.#.#.###.#.#.#.###.#.###.#.###.#.###.#.#.#.#.#.###.###.#.#.#.#.###.#.#.#.#.#.#.#.###.#.#.###.#######.#######.#.#.#
#...#...#.........#...#...#...#...#.#.#.#...#.#.#...#...#.#...#...#.#...#.#...#...#.#.#.#...#.#...#.#.#.#.#.....#...#...###.....#.......#.#.#
###################.#############.#.#.#.###.#.#.#.#####.#.###.#####.#####.#.###.###.#.#.###.#.#####.#.#.#.###########.#####.#####.#######.#.#
#.....###...###...#.........#...#...#.#.#...#.#.#.#.....#.#...#...#.#.....#...#.###.#.#.#...#...#...#.#.#.#...........#...#...#...#...#...#.#
#.###.###.#.###.#.#########.#.#.#####.#.#.###.#.#.#.#####.#.###.#.#.#.#######.#.###.#.#.#.#####.#.###.#.#.#.###########.#.###.#.###.#.#.###.#
#...#.....#.....#.#.....###...#.....#.#.#...#.#.#.#...#...#...#.#.#.#.#...#...#...#.#...#.#...#.#.#...#...#...#...#.....#.....#...#.#.#.#...#
###.#############.#.###.###########.#.#.###.#.#.#.###.#.#####.#.#.#.#.#.#.#.#####.#.#####.#.#.#.#.#.#########.#.#.#.#############.#.#.#.#.###
###.............#.#...#.......#.....#.#...#.#.#.#.#...#.....#.#.#...#.#.#.#...###.#...#...#.#...#...#.........#.#.#.#...........#...#...#...#
###############.#.###.#######.#.#####.###.#.#.#.#.#.#######.#.#.#####.#.#.###.###.###.#.###.#########.#########.#.#.#.#########.###########.#
#...#...#...#...#.....#.......#.....#.....#.#.#.#.#...#.....#...###...#.#.#...#...#...#...#.......#...#.........#...#.#...#...#.........#...#
#.#.#.#.#.#.#.#########.###########.#######.#.#.#.###.#.###########.###.#.#.###.###.#####.#######.#.###.#############.#.#.#.#.#########.#.###
#.#.#.#.#.#.#.........#.....###...#.......#.#.#.#...#.#.......###...#...#.#.#...#...#####...#.....#.....#...........#...#...#...#...###...###
#.#.#.#.#.#.#########.#####.###.#.#######.#.#.#.###.#.#######.###.###.###.#.#.###.#########.#.###########.#########.###########.#.#.#########
#.#...#.#.#.#...#.....#.....#...#.#...#...#...#.#...#...#.....#...#...###...#...#.....#####.#.#.........#.........#.#.........#...#.........#
#.#####.#.#.#.#.#.#####.#####.###.#.#.#.#######.#.#####.#.#####.###.###########.#####.#####.#.#.#######.#########.#.#.#######.#############.#
#.....#.#.#...#.#.....#.....#...#...#.#...#.....#.#.....#.#...#...#.#...#.......#...#...#...#.#.#.....#...........#.#.......#...#...#.......#
#####.#.#.#####.#####.#####.###.#####.###.#.#####.#.#####.#.#.###.#.#.#.#.#######.#.###.#.###.#.#.###.#############.#######.###.#.#.#.#######
#.....#.#.....#.......#...#...#.....#.....#.....#.#.....#...#...#.#...#.#.....#...#.#...#...#.#.#.#...#...#.....###.......#.#...#.#.#.......#
#.#####.#####.#########.#.###.#####.###########.#.#####.#######.#.#####.#####.#.###.#.#####.#.#.#.#.###.#.#.###.#########.#.#.###.#.#######.#
#.....#.#...#...#.....#.#.#...#...#.........#...#.....#.#.......#.#.....#.....#...#.#.#...#.#.#...#.....#...#...#...#...#...#.....#.........#
#####.#.#.#.###.#.###.#.#.#.###.#.#########.#.#######.#.#.#######.#.#####.#######.#.#.#.#.#.#.###############.###.#.#.#.#####################
#.....#...#...#.#.#...#.#.#.....#.......#...#...#...#.#.#.......#.#.....#.......#.#.#.#.#.#...###...#.......#.....#...#.........#...###.....#
#.###########.#.#.#.###.#.#############.#.#####.#.#.#.#.#######.#.#####.#######.#.#.#.#.#.#######.#.#.#####.###################.#.#.###.###.#
#.....#...#...#...#.....#...#.........#.#.....#.#.#...#.....#...#.#...#.......#...#...#.#.#...#...#...#...#.....#...#...........#.#.....#...#
#####.#.#.#.###############.#.#######.#.#####.#.#.#########.#.###.#.#.#######.#########.#.#.#.#.#######.#.#####.#.#.#.###########.#######.###
#...#...#.#.....#...........#.#.......#.......#.#.....###...#.###.#.#.#.......###...###.#.#.#.#...#.....#.....#.#.#.#...#...#...#.#...#...###
#.#.#####.#####.#.###########.#.###############.#####.###.###.###.#.#.#.#########.#.###.#.#.#.###.#.#########.#.#.#.###.#.#.#.#.#.#.#.#.#####
#.#.#...#.....#.#.......#...#.#.#...###.......#.#...#...#...#...#...#.#...###...#.#.#...#...#.#...#.#.........#...#.....#.#...#...#.#...#...#
#.#.#.#.#####.#.#######.#.#.#.#.#.#.###.#####.#.#.#.###.###.###.#####.###.###.#.#.#.#.#######.#.###.#.###################.#########.#####.#.#
#.#...#.....#.#.#...###...#...#...#...#.#.....#...#...#...#...#.....#.....#...#...#...#...#...#...#.#...........###.....#.#.........#...#.#.#
#.#########.#.#.#.#.#################.#.#.###########.###.###.#####.#######.###########.#.#.#####.#.###########.###.###.#.#.#########.#.#.#.#
#...#.....#...#...#...........#.......#.#.....#...###...#...#.#...#.....#...#...........#.#...###...#.........#...#...#...#.......###.#...#.#
###.#.###.###################.#.#######.#####.#.#.#####.###.#.#.#.#####.#.###.###########.###.#######.#######.###.###.###########.###.#####.#
###...###...#.....#...#.....#...#...###.#.....#.#.#...#.#...#.#.#.#...#.#...#.#...........#...#...###.......#.#...###.#.........#.....#...#.#
###########.#.###.#.#.#.###.#####.#.###.#.#####.#.#.#.#.#.###.#.#.#.#.#.###.#.#.###########.###.#.#########.#.#.#####.#.#######.#######.#.#.#
#...........#.###...#...###.......#.....#.......#...#.#.#...#.#.#...#.#.#...#.#.........#...#...#...#.......#...#S....#...#...#...#...#.#.#.#
#.###########.#######################################.#.###.#.#.#####.#.#.###.#########.#.###.#####.#.###################.#.#.###.#.#.#.#.#.#
#...#...#...#.....#.......#...........#...#...#...#...#...#.#.#...#...#.#.#...#.........#.###.....#.#.....#########.....#...#...#...#.#.#...#
###.#.#.#.#.#####.#.#####.#.#########.#.#.#.#.#.#.#.#####.#.#.###.#.###.#.#.###.#########.#######.#.#####.#########.###.#######.#####.#.#####
###...#.#.#.#...#.#.....#.#.........#.#.#.#.#...#...#...#.#.#.....#.#...#...#...#.......#...###...#.......#######...###.#.....#...###...#...#
#######.#.#.#.#.#.#####.#.#########.#.#.#.#.#########.#.#.#.#######.#.#######.###.#####.###.###.#################.#####.#.###.###.#######.#.#
#.......#.#.#.#...#.....#...........#...#.#.#.........#.#...#...###...###...#.....#...#...#.....#...#############.....#.#.###...#...###...#.#
#.#######.#.#.#####.#####################.#.#.#########.#####.#.#########.#.#######.#.###.#######.#.#################.#.#.#####.###.###.###.#
#.......#.#.#...#...#.................###...#.#.........#...#.#.#...###...#...#.....#.###...#.....#.###.....#.....#...#...#...#...#.....#...#
#######.#.#.###.#.###.###############.#######.#.#########.#.#.#.#.#.###.#####.#.#####.#####.#.#####.###.###.#.###.#.#######.#.###.#######.###
#...###...#...#.#.#...#...#...........#...###.#.#.....###.#.#.#.#.#.#...#.....#.....#.......#...#...###...#...###.#.....#...#...#...#.....###
#.#.#########.#.#.#.###.#.#.###########.#.###.#.#.###.###.#.#.#.#.#.#.###.#########.###########.#.#######.#######.#####.#.#####.###.#.#######
#.#.#...#...#.#.#...#...#...#...#.......#...#.#.#...#.#...#...#...#.#.#...#...#.....#.........#.#E#######.......#.......#...#...###...###...#
#.#.#.#.#.#.#.#.#####.#######.#.#.#########.#.#.###.#.#.###########.#.#.###.#.#.#####.#######.#.###############.###########.#.###########.#.#
#.#.#.#.#.#.#...#...#.........#...#.........#.#...#.#...#...........#.#...#.#.#.#.....#.......#...#####.......#.........#...#...#...#...#.#.#
#.#.#.#.#.#.#####.#.###############.#########.###.#.#####.###########.###.#.#.#.#.#####.#########.#####.#####.#########.#.#####.#.#.#.#.#.#.#
#.#...#...#.......#.........###...#...#...###.#...#.#.....###...#...#.#...#.#.#...#...#...........#####.....#.#...#.....#...#...#.#.#.#...#.#
#.#########################.###.#.###.#.#.###.#.###.#.#######.#.#.#.#.#.###.#.#####.#.#####################.#.#.#.#.#######.#.###.#.#.#####.#
#.#...#.....#...#...#.....#.#...#.....#.#.#...#.....#.......#.#...#.#.#...#.#.#.....#.#.....#...#...#.......#...#...###...#.#.#...#.#...#...#
#.#.#.#.###.#.#.#.#.#.###.#.#.#########.#.#.###############.#.#####.#.###.#.#.#.#####.#.###.#.#.#.#.#.#################.#.#.#.#.###.###.#.###
#.#.#.#.#...#.#...#...#...#...#.....###.#.#.....#...........#.#.....#...#.#.#.#.....#...#...#.#.#.#.#.#...#...#...#...#.#.#.#...#...###.#...#
#.#.#.#.#.###.#########.#######.###.###.#.#####.#.###########.#.#######.#.#.#.#####.#####.###.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#####.#####.###.#
#...#...#...#.#.....###...#.....###.....#.......#.............#.....#...#...#.#.....#...#.....#.#.#.#...#...#...#...#.#.#.#...#...#...#.#...#
###########.#.#.###.#####.#.#######################################.#.#######.#.#####.#.#######.#.#.#################.#.#.###.#.###.#.#.#.###
#.......###...#...#...#...#.#.........#.....#.....#.............#...#...#.....#.......#.......#.#.#...#...........#...#.#.#...#.#...#...#...#
#.#####.#########.###.#.###.#.#######.#.###.#.###.#.###########.#.#####.#.###################.#.#.###.#.#########.#.###.#.#.###.#.#########.#
#.....#.#...#...#...#...#...#.......#...#...#.#...#.....#.....#...#.....#.......#...#.........#.#.#...#.........#...#...#...#...#.#.....#...#
#####.#.#.#.#.#.###.#####.#########.#####.###.#.#######.#.###.#####.###########.#.#.#.#########.#.#.###########.#####.#######.###.#.###.#.###
#.....#...#...#.###.....#.#...#...#.....#.....#.#...#...#...#.#...#.....#.......#.#.#.........#.#.#...........#.......#.....#.....#...#.#...#
#.#############.#######.#.#.#.#.#.#####.#######.#.#.#.#####.#.#.#.#####.#.#######.#.#########.#.#.###########.#########.###.#########.#.###.#
#.........#...#.........#.#.#...#.......#...###...#...#####.#.#.#...#...#...#...#.#.#...#...#.#.#...#.....###...#.....#.###...#...#...#.....#
#########.#.#.###########.#.#############.#.###############.#.#.###.#.#####.#.#.#.#.#.#.#.#.#.#.###.#.###.#####.#.###.#.#####.#.#.#.#########
#.........#.#...#...#...#.#...........#...#.#...#...#...#...#.#.#...#...#...#.#...#.#.#...#.#.#.###...###.....#.#...#.#.....#...#.#.#.......#
#.#########.###.#.#.#.#.#.###########.#.###.#.#.#.#.#.#.#.###.#.#.#####.#.###.#####.#.#####.#.#.#############.#.###.#.#####.#####.#.#.#####.#
#.....#.....###...#...#...###.........#...#.#.#.#.#.#.#.#...#.#.#.#...#.#.###.....#.#.....#.#.#.#...#.........#.#...#.....#.....#.#...#.....#
#####.#.#####################.###########.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#######.#.#####.#.#.#.#.#.#.#########.#.#######.#####.#.#####.#####
#.....#.#.....#.......#...#...#.......#...#.#.#.#.#.#.#.#...#.#.#...#.#.#.#...#...#.....#.#...#.#.#.#.#.......#...#...###.....#.#.....#.....#
#.#####.#.###.#.#####.#.#.#.###.#####.#.###.#.#.#.#.#.#.#.###.#.#####.#.#.#.#.#.#######.#.#####.#.#.#.#.#####.#####.#.#######.#.#####.#####.#
#.#...#.#...#...#...#...#.#...#.#.....#.#...#.#.#.#.#.#.#.#...#.#.....#.#.#.#.#.......#.#...#...#.#.#...#...#.......#.......#...#.....#.....#
#.#.#.#.###.#####.#.#####.###.#.#.#####.#.###.#.#.#.#.#.#.#.###.#.#####.#.#.#.#######.#.###.#.###.#.#####.#.###############.#####.#####.#####
#...#...###...#...#.....#.###.#.#...#...#...#.#...#.#.#...#...#.#.....#.#.#.#...#.....#.#...#...#.#.#...#.#.#...#.....#...#.....#.....#.....#
#############.#.#######.#.###.#.###.#.#####.#.#####.#.#######.#.#####.#.#.#.###.#.#####.#.#####.#.#.#.#.#.#.#.#.#.###.#.#.#####.#####.#####.#
#.....#...###...#.......#.....#...#...#.....#.#.....#.....#...#.....#.#.#.#...#.#.#.....#...#...#.#.#.#...#.#.#.#...#.#.#.....#...#...#.....#
#.###.#.#.#######.###############.#####.#####.#.#########.#.#######.#.#.#.###.#.#.#.#######.#.###.#.#.#####.#.#.###.#.#.#####.###.#.###.#####
#...#.#.#.#.....#.........#...#...#...#.#.....#.#...#...#.#...#...#.#.#.#...#.#...#.....#...#...#.#.#.....#.#.#.#...#.#.....#...#.#...#.....#
###.#.#.#.#.###.#########.#.#.#.###.#.#.#.#####.#.#.#.#.#.###.#.#.#.#.#.###.#.#########.#.#####.#.#.#####.#.#.#.#.###.#####.###.#.###.#####.#
#...#...#...#...#...#...#.#.#.#.#...#...#.#.....#.#.#.#...###.#.#...#.#.###...#.........#...#...#.#...#...#.#.#.#.###...#...###...###...#...#
#.###########.###.#.#.#.#.#.#.#.#.#######.#.#####.#.#.#######.#.#####.#.#######.###########.#.###.###.#.###.#.#.#.#####.#.#############.#.###
#...........#.#...#...#...#.#...#.#.....#.#...#...#...###.....#.....#.#.....###.....#.....#.#.#...###.#...#.#.#.#.....#.#...###...#...#.#...#
###########.#.#.###########.#####.#.###.#.###.#.#########.#########.#.#####.#######.#.###.#.#.#.#####.###.#.#.#.#####.#.###.###.#.#.#.#.###.#
#.....#.....#...#...#...#...#.....#...#...###.#.........#.#...#...#.#...#...#.....#.#.###.#.#.#.....#.#...#.#.#.#...#.#.#...#...#...#.#.#...#
#.###.#.#########.#.#.#.#.###.#######.#######.#########.#.#.#.#.#.#.###.#.###.###.#.#.###.#.#.#####.#.#.###.#.#.#.#.#.#.#.###.#######.#.#.###
#.#...#.....#...#.#.#.#.#.#...#.......#.......#...#...#.#.#.#.#.#...#...#.###...#...#...#.#.#...#...#.#...#.#.#.#.#...#.#.....#...#...#.#...#
#.#.#######.#.#.#.#.#.#.#.#.###.#######.#######.#.#.#.#.#.#.#.#.#####.###.#####.#######.#.#.###.#.###.###.#.#.#.#.#####.#######.#.#.###.###.#
#.#.###...#.#.#.#.#.#.#.#.#...#.......#...#...#.#.#.#.#.#...#.#.....#...#.#.....#...#...#.#.###.#...#.#...#...#.#.....#.#...#...#.#.###...#.#
#.#.###.#.#.#.#.#.#.#.#.#.###.#######.###.#.#.#.#.#.#.#.#####.#####.###.#.#.#####.#.#.###.#.###.###.#.#.#######.#####.#.#.#.#.###.#.#####.#.#
#.#.....#...#.#.#.#.#.#...#...#.....#.#...#.#.#.#...#...###...#...#...#.#.#.....#.#.#.#...#...#.....#.#.......#.#...#.#...#.#...#.#.....#.#.#
#.###########.#.#.#.#.#####.###.###.#.#.###.#.#.###########.###.#.###.#.#.#####.#.#.#.#.#####.#######.#######.#.#.#.#.#####.###.#.#####.#.#.#
#...#.....#...#.#.#.#.###...#...###...#.#...#.#...#.........#...#.#...#.#.#.....#.#.#.#.#...#.#...###.....#...#.#.#.#.###...#...#.#.....#...#
###.#.###.#.###.#.#.#.###.###.#########.#.###.###.#.#########.###.#.###.#.#.#####.#.#.#.#.#.#.#.#.#######.#.###.#.#.#.###.###.###.#.#########
#...#.#...#...#...#.#.#...#...#.........#...#.....#.....#...#.#...#...#.#.#.....#.#.#.#.#.#.#...#.......#.#...#.#.#.#.#...#...###...#...#...#
#.###.#.#####.#####.#.#.###.###.###########.###########.#.#.#.#.#####.#.#.#####.#.#.#.#.#.#.###########.#.###.#.#.#.#.#.###.#########.#.#.#.#
#...#.#.#...#.....#.#.#...#...#.......#...#...#.......#.#.#.#.#...#...#...#...#.#.#...#.#.#.#...#.......#.#...#.#.#...#...#...........#...#.#
###.#.#.#.#.#####.#.#.###.###.#######.#.#.###.#.#####.#.#.#.#.###.#.#######.#.#.#.#####.#.#.#.#.#.#######.#.###.#.#######.#################.#
###.#.#.#.#.......#.#.#...#...#.......#.#.#...#.#...#...#.#.#.###.#...#.....#...#...#...#.#...#.#.......#...#...#.###...#.#...#...#...#.....#
###.#.#.#.#########.#.#.###.###.#######.#.#.###.#.#.#####.#.#.###.###.#.###########.#.###.#####.#######.#####.###.###.#.#.#.#.#.#.#.#.#.#####
#...#.#.#.........#...#...#...#.#...#...#.#.###...#...#...#...#...#...#.......#.....#...#...#...#.....#.....#...#.....#.#...#.#.#.#.#.#.....#
#.###.#.#########.#######.###.#.#.#.#.###.#.#########.#.#######.###.#########.#.#######.###.#.###.###.#####.###.#######.#####.#.#.#.#.#####.#
#.#...#...#.......#...###.#...#.#.#...#...#.#.........#.......#...#...#.......#...#.....#...#.#...###.#.....#...#...#...###...#.#.#.#.#.....#
#.#.#####.#.#######.#.###.#.###.#.#####.###.#.###############.###.###.#.#########.#.#####.###.#.#####.#.#####.###.#.#.#####.###.#.#.#.#.#####
#.#...#...#.......#.#...#.#...#.#...###...#.#.#...#.....#.....#...#...#.#...#.....#...#...#...#.....#.#.....#...#.#.#.#...#.#...#...#.#.....#
#.###.#.#########.#.###.#.###.#.###.#####.#.#.#.#.#.###.#.#####.###.###.#.#.#.#######.#.###.#######.#.#####.###.#.#.#.#.#.#.#.#######.#####.#
#...#.#...#...#...#...#...#...#.#...#.....#.#.#.#.#...#.#.#.....#...#...#.#.#.#.......#.#...#...#...#.#...#...#.#.#.#...#.#.#.#.......#...#.#
###.#.###.#.#.#.#####.#####.###.#.###.#####.#.#.#.###.#.#.#.#####.###.###.#.#.#.#######.#.###.#.#.###.#.#.###.#.#.#.#####.#.#.#.#######.#.#.#
###...###...#...#####.......###...###.......#...#.....#...#.......###.....#...#.........#.....#...###...#.....#...#.......#...#.........#...#
#############################################################################################################################################
"""


def get_costs(data: str):
    data = data.strip().split("\n")

    def val(x: str):
        if x == "#":
            return -np.inf
        elif x == "E":
            return 1
        elif x == "S":
            return -1
        return 0

    track = np.array([[val(x) for x in row] for row in data])

    start_index = np.where(track == -1)
    if len(start_index) == 0:
        raise ValueError("No start found!")
    start_pos = (start_index[0][0], start_index[1][0])

    def fill_costs(track, pos):
        x, y = pos

        if track[x, y] == -np.inf or track[x, y] == 1:
            return track[x, y]

        track[x, y] = -np.inf

        track[x, y] = (
            max(
                fill_costs(track, (x - 1, y)),
                fill_costs(track, (x, y - 1)),
                fill_costs(track, (x, y + 1)),
                fill_costs(track, (x + 1, y)),
            )
            + 1
        )
        return track[x, y]

    fill_costs(track, start_pos)
    costs = track - 1
    costs[costs == -np.inf] = np.nan

    return costs


def get_savings(costs: np.ndarray, cheat: tuple[int, int]) -> np.ndarray:
    d_rows, d_cols = cheat

    def shift(x: np.ndarray, right: int, down: int) -> np.ndarray:
        if right > 0:
            x = np.pad(
                x, ((0, 0), (right, 0)), mode="constant", constant_values=np.nan
            )[:, :-right]
        elif right < 0:
            x = np.pad(
                x, ((0, 0), (0, -right)), mode="constant", constant_values=np.nan
            )[:, -right:]
        if down > 0:
            x = np.pad(x, ((down, 0), (0, 0)), mode="constant", constant_values=np.nan)[
                :-down, :
            ]
        elif down < 0:
            x = np.pad(
                x, ((0, -down), (0, 0)), mode="constant", constant_values=np.nan
            )[-down:, :]
        return x

    savings = costs - shift(costs, -d_cols, -d_rows) - (np.abs(d_cols) + np.abs(d_rows))
    savings = np.nan_to_num(savings, nan=-np.inf)
    return savings


def num_cheats_above_threshold(
    costs: np.ndarray, cheats: list[tuple[int, int]], threshold: int
) -> int:
    num_cheats_above_threshold = 0
    for cheat in cheats:
        savings = get_savings(costs, cheat)
        num_cheats_above_threshold += np.sum(savings >= threshold)
    return num_cheats_above_threshold


def get_cheats_up_to(max_length: int) -> list[tuple[int, int]]:
    cheats = []
    for d_rows in range(-max_length, max_length + 1):
        for d_cols in range(-max_length, max_length + 1):
            length = abs(d_rows) + abs(d_cols)
            if length > 0 and length <= max_length:
                cheats.append((d_rows, d_cols))
    return cheats


def solve1(data: str):
    costs = get_costs(data)
    cheats = get_cheats_up_to(2)
    return num_cheats_above_threshold(costs, cheats, 100)


def solve2(data: str):
    costs = get_costs(data)
    cheats = get_cheats_up_to(20)
    return num_cheats_above_threshold(costs, cheats, 100)


testData = """
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
"""


class Tests(unittest.TestCase):
    def test_costs(self):
        self.assertEqual(np.max(np.nan_to_num(get_costs(testData), nan=-np.inf)), 84.0)

    def test_get_savings_1(self):
        self.assertEqual(get_savings(get_costs(testData), (0, 2))[1, 7], 12)

    def test_get_savings_2(self):
        self.assertEqual(get_savings(get_costs(testData), (0, 2))[7, 9], 20)

    def test_num_cheats_above_threshold(self):
        costs = get_costs(testData)
        cheats = get_cheats_up_to(2)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 40), 2)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 38), 3)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 36), 4)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 20), 5)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 12), 8)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 10), 10)
        self.assertEqual(num_cheats_above_threshold(costs, cheats, 8), 14)

    def test_solve1(self):
        self.assertEqual(solve1(data), 1502)

    def test_get_cheats_up_to(self):
        self.assertEqual(
            sorted(get_cheats_up_to(2)),
            sorted(
                [
                    (-1, 0),
                    (0, 1),
                    (1, 0),
                    (0, -1),
                    (-1, -1),
                    (-2, 0),
                    (-1, 1),
                    (0, 2),
                    (1, 1),
                    (2, 0),
                    (1, -1),
                    (0, -2),
                ]
            ),
        )


if __name__ == "__main__":
    print(solve1(data))

    print(solve2(data))

    unittest.main()
